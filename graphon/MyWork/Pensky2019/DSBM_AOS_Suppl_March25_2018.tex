%  This is the file with proofs
% The root file is DSBM_AOS_March25_2018.tex


\section{Supplemental Material:\ Proofs}
\label{sec:suppl}
% \setcounter{equation}{0}


\renewcommand{\theequation}{S.\arabic{equation}}
 \setcounter{equation}{0}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


 \input{DSBM_AOS_Proofs_March25_2018.tex}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Proof of Theorem \ref{th:sparse} } 

% Let $\bC$ be a clustering matrix and $\PCJ$ be the projection matrix on the column space of matrix $(\bC \bW^T)_J$.
Denote $\bW^T = \bV$ and recall that $\bS^2 = \bC^T \bC$ where $\bS^2$ is the diagonal matrix with entries $N_k^{(l)}$, 
the number of nodes in the pair of classes $k = (k_1, k_2)$ at time $t_l$. 
Note that  $(\bC \bW^T)_J = \bC \bV_J$, so that $\PCJ = \bC \bV_J [\bV_J^T \bC^T \bC \bV_j]^{-1} \bV_J^T \bC^T$
can be written as 
\bes 
\PCJ = \bC \bS^{-1} \PSJ (\bC \bS^{-1})^T \quad \mbox{with} \quad \PSJ = \bS \bV_J (\bV_J^T \bS^2 \bV_J)^{-1} \bV_J^T \bS.
\ees
Here, $\PSJ$ is the projection matrix on the column space of matrix $\bS \bV_J$. 

%
Since $(\hbd, \hbC, \hm, \hJ)$ are solutions of optimization problem \fr{opt_problem_balanced},
for any   $J$  and $\bds = \vect(\bDs)$,  one has
\begin{align}  \label{new_main_ineq}
\|\ba - \hbC \hbW^T\, \hbd_{(\hJ)}\|^2 & + 2  \rho_n\,  \Pen(|\hJ|,\hm) \\
& \leq \|\ba - \bCs \bWs^T \bds_{(J)} \|^2 + 2  \rho_n\, \Pen(|J|,\ms), \nonumber
\end{align} 
It follows from \fr{true_model} that for any $m,J,\bd$ and $\bC$
\begin{align*} 
& \|\ba -   \bC \bW^T  \bd_{(J)}\|^2  = \|(\ba - \bCs \bWs^T \bds) +  (\bCs \bWs^T \bds -  \bC \bW^T \bd_{(J)})\|^2 \\
& =   \|\bxi\|^2 + \|\bC \bW^T \bd_{(J)} - \bCs \bWs^T \bds\|^2 + 2 \bxi^T (\bCs \bWs^T \bds -  \bC \bW^T \bd_{(J)}).
\end{align*}
Hence, plugging the last identity into the inequality \fr{new_main_ineq}, derive that
% for any $m$, $J$, $\bC$  and $\bd$
\begin{align} \label{new_main_ineq1}
\|\hbC \hbW^T \hbd_{(\hJ)} - \bCs \bWs^T \bds\|^2 & \leq \|\bCs \bWs^T \bds_{(J)} - \bCs \bWs^T \bds\|^2 \\
& +    \Del + \rho_n\, \Pen(|J|,\ms) - \rho_n\, \Pen(|\hJ|,\hm), \nonumber 
\end{align}
%
where, $\Del   = 2 |\bxi^T (\hbC \hbW^T \hbd_{(\hJ)} - \bCs \bWs^T \bds_{(J)})|$. 
Note that, due to \fr{projection} and \fr{hbd_solution}, one has  $\hbC \hbW^T \hbd_{(\hJ)} = \hPChJ\, \ba$ 
with $\ba$ is given by \fr{true_model}, $\bCs \bWs^T \bds_{(J)} = \PCJs \btes$ and $\bCs \bWs^T \bds = \btes$.  
Therefore,
\begin{align}
  & \Del    \leq  \Del_1 + \Del_2 + \Del_3, \label{new_Del123}\\
  \Del_1   = 2 |\bxi^T \PCJso \btes|, \quad %\nonumber \\
  & \Del_2    = 2 |\bxi^T \hPChJo \btes|, \quad  
  \Del_3   = 2  \bxi^T \hPChJ\, \bxi.  \nonumber
\end{align}
% Now, we need to find upper bounds for each of the terms in \fr{new_Del123}.

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
In order to obtain  an upper bound for $\Del_1$ and $\Del_2$, note that by Bernstein inequality, for any $\bC$, $m$, $\bte$, $J$ and
for any $x>0$ with probability at least $1 - 2 e^{-x}$, one has 
\bes
2 |\bxi^T \PCJo \bte| \leq 2 \sqrt{2 x \rho_n\, \|\PCJo \bte \|^2 } + 4/3\,  \|\PCJo \bte \|_{\infty}\, x.
\ees
Due to $2 ab \leq a^2 + b^2$, obtain that with probability at least $1 - 2 e^{-x}$
\be \label{eq:Bernstein}
2 |\bxi^T \PCJo \bte| \leq 0.5\, \|\PCJo \bte \|^2 + 4\, \lkr \rho_n\,   +    \|\PCJo \bte \|_{\infty}/3 \rkr x
\ee 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
Applying \fr{eq:Bernstein}  to $\Del_1$ with  $\bte = \btes$ and  $x=t>0$,   using \fr{uni_sparse_cond} and keeping in mind that 
$\|\bLams\|_\infty = \|\btes\|_\infty \leq \rhons \leq \rho_n$, obtain
\be \label{new_Del1er}
\PP \lfi \Del_1 -  0.5\, \| \bCs \bWs^T \bds - \bCs \bWs^T \bds_{(J)} \|^2  - 4\,  \rho_n (1 + B_0/3) t \leq  0  \rfi \geq 1 - 2 e^{-t}.
\ee
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
In order to obtain an upper bound for $\Del_2$, note that, similarly to the proof of Theorem~\ref{th:oracle}, one has  
\bes
\|\hbC \hbW^T \hbd_{(\hJ)} - \bCs \bWs^T \bds\|^2   
% + \|\hPhJ\, \bxi\|^2 + \| (\bI_{NL} - \hPhJ)  \bCs \bWs^T \bds\|^2 
\geq  \| (\bI_{NL} - \hPChJ)  \bCs \bWs^T \bds\|^2 = \|\hPChJo \bCs \bWs^T \bds\|^2.
\ees
Hence,  due to condition \fr{uni_sparse_cond}, since $\|\btes\|_\infty \leq \rhons\leq \rho_n$, obtain
\begin{align*} 
& \PP \lfi \Del_2 -  0.5\,  \|\hbC \hbW^T \hbd_{(\hJ)} - \bCs \bWs^T \bds\|^2 \leq
4 \lkr   \rho_n    + 1/3\,  \|\hPChJo \btes \|_{\infty} \rkr   x   \rfi \geq \\ 
& \PP \lfi \Del_2 -   0.5\,  \| \hPChJo  \bCs \bWs^T \bds\|^2 - 4\,  \rho_n (1 + B_0/3) x \leq 0 \rfi   
\end{align*}
Set  $x  = t + R(\hm,\hJ,L)$ where $R(m,J,L)$ is defined in \fr{RDel}.
Applying inequality \fr{eq:Bernstein} with $\bte = \btes$ % \bCs \bWs^T \bds$ 
together with the union bound  over $m=1, \cdots, n$, $\bC \in \calZ_{\bal} (m,n,n_0,L,\aleph_1,\aleph_2)$ 
and $J$ with $|J| = 1, \cdots, ML,$ we derive % that with probability at least $1 - 6 e^{-t}$, one has     
\begin{align}  \label{new_Del2er}
\PP \lfi
\Del_2 \right. & -  0.5\,  \|\hbC \hbW^T \hbd_{(\hJ)} - \bCs \bWs^T \bds\|^2  \\
& \left. - 4\,  \rho_n (1    + B_0/3)
(t + R(\hm,\hJ,L)) \leq 0  \rfi \geq 1 - 6 e^{-t}. \nonumber
\end{align} 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  
For an upper bound for $\Del_3$,  write   
$$
\Del_3   = 2  \bxi^T \hbC \hbS^{-1} \hPShJ (\hbC \hbS^{-1})^T \bxi    = 2  \boeta^T   \hPShJ    \boeta.
$$
Here, for any fixed $\hbC = \bC$, due to Corollary~\ref{cor:subgaus}, vector $\boeta = (\bC \bS^{-1})^T \bxi$
has independent sub-Gaussian components such that,  for any index $i$ corresponding to a pair of nodes 
$k = (k_1, k_2)$ at time $t_l$,  one has 
$$
\| \boeta_{i} \|_{\psi_2}^2 \leq   1.5\, e^2  \, \max( \|\btes\|_{\infty}, [N^{(l)}_{k}]^{-1}).
$$
Observe that, due to \fr{eq:Nkl} and \fr{balanced},    
$$
N^{(l)}_{{k_1},{k_2}} \geq  0.5\, n^{(l)}_{k_1} n^{(l)}_{k_2} \geq 0.5\, \aleph_1^2 (n/m)^2.
$$
Therefore, 
$$
\| \boeta_{i} \|_{\psi_2}^2 \leq  \rho_{m,n} \quad \mbox{where} \quad  \rho_{m,n}= 
\frac{3e^2}{2} \, \max \lkr \rhons,  \frac{2}{\aleph_1^2}\, \frac{m^2}{n^2}\rkr.
$$   
Therefore, by Lemma 5.5 of Vershynin (2012), obtain that there exists an absolute constant $C_0$ such that 
for any vector  $\bt$  one has 
$$
\EE [\exp(\boeta^T \bt)] \leq \exp(C_0 \rho_{m,n} \|\bt\|^2). 
$$
Applying Lemma~\ref{lem:subgaus_quadr_err} with $\sig^2 = 2 C_0 \rho_{m,n}$, derive that for any fixed 
$\bC$ and $J$, one has
\bes  
\PP \lfi 2 \boeta  \PSJ \boeta   -  4 C_0 \rho_{m,n}\, \lkr 2 |J| +   3 t \rkr \leq 0 \rfi \geq  1- e^{-t}.
\ees
Again, taking a union bound over $m=1, \cdots, n$, $\bC \in \calZ_{\bal} (m,n,n_0,L,\aleph_1,\aleph_2)$ 
and $J$ with $|J| = 1, \cdots, ML,$ we derive that, due to $\rhons \leq \rho_n$, for some absolute constant $\tCo$  one has
\begin{align}  \label{new_Del3er}
\PP \lfi \Del_3 - \tCo \max \lkr \rho_n, \frac{\hm^2}{n^2} \rkr\,  [R(\hm,\hJ,L) + t] \leq 0 \rfi 
\geq  1- e^{-t}. 
\end{align}
where $R(m,J,L)$ is defined in \fr{RDel}.
The rest of the proof  of \fr{oracle_prob_sparse1} is very similar to the proof of Theorem~\ref{th:oracle}.
In order to establish \fr{oracle_prob_sparse2}, follow the arguments of the proof of Corollary~\ref{cor:upper_smooth_DSBM}.
 




 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{ Proof  of Theorem~\ref{th:upper_graphon}, Corollary~\ref{cor:upper_graphon} and 
Theorem~\ref{th:lower_graphon} }


This section contains proofs for the upper and the lower bounds for the risks in the case  of  graphon estimation.
\\

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
\noindent
{\bf Proof of Theorem \ref{th:upper_graphon}. }
To prove \fr{graph_upper}, we approximate the graphon by the DSBM and use inequality \fr{oracle_expec} in  Theorem \ref{th:oracle}.
In order to find an upper bound for the bias term, we need to cluster the nodes and create an approximate 
connectivity tensor $\bQ$. For this purpose, let $h \geq 1$ be a positive integer and denote
$\kappa_j = 1 + [(\beta_j - \beta_{j-1})h]$ where $[x]$ is the largest integer
no larger than $x$.  For $k = 1, \cdots, \kappa_j$ and $j = 1, \cdots, r$, consider a set of intervals 
\bes
U_{j,k}= (U_{j,k}^{(1)}, U_{j,k}^{(2)}] \quad \mbox{with} \quad  U_{j,k}^{(1)} =  \beta_{j-1} + (k-1)/h, \quad 
U_{j,k}^{(2)} = \min\{\beta_{j-1} + k/h, \beta_j\}.
% \quad k = 1, \cdots, \kappa_j; \ j = 1, \cdots, r.
\ees
Intervals $U_{j,k}$ subdivide every interval $(\beta_{j-1}, \beta_j]$ 
into $\kappa_j$ sub-intervals of  length at most $1/h$ and the total number of intervals 
is equal to 
\bes 
m = \sum_{j=1}^r \kappa_j.
\ees
Re-number the intervals consecutively as $U_1, \cdots, U_m$ and observe that since 
$(\beta_j - \beta_{j-1})h \leq \kappa_j \leq 1 +  (\beta_j - \beta_{j-1})h$,
one has 
\be \label{sr}
h \leq m \leq h+r.
\ee
The value $m$ in \fr{sr}  acts   as a number of classes.  Indeed, if $\zeta_i \in U_k$,
we place node $i$ into class $\Om_k$ and set $\bZ_{i, j} = \II(j=k)$. 


Let $\bTe^*$ be the true tensor of connection probabilities. Set $\bPhis = \bTes \bH^T$, 
$\bQ  = (\bZ^T \bZ)^{-1} \bZ^T \bTe^*$ and  $\bV  = \bQ  \bH^T$. 
%
Since $\bH$ is an orthogonal matrix,  the bias term  $\| \bC \bW^T \bd_{(J)} - \btes \|^2$ 
in the oracle inequality \fr{oracle_expec} is equal to 
\begin{align}  \nonumber
& \| \bC \bW^T \bd_{(J)} - \btes \|^2   =   \|\bZ \bV^{(\rho)} \bH - \bTes \|^2 = \|\bZ \bV^{(\rho)} - \bTe \bH^T\|^2\\
\label{bias_all} 
& =   \|\bZ \bV^{(\rho)} -  \bPhis \|^2 =     \|\bZ \bV^{(\rho)} -  \bPhis^{(\rho)}\|^2
+ \| \bPhis - (\bPhis)^{(\rho)}\|^2.
\end{align} 
The first term in the right-hand side of \fr{bias_all} describes how well the first $L^\rho$ columns of matrix $\bV^{(\rho)}$
represent the first $L^\rho$ columns $(\bPhis)^{(\rho)}$ of matrix $\bPhis$. The second term 
$\| \bPhis - (\bPhis)^{(\rho)}\|^2 = \| \bTes - (\bPhis)^{(\rho)} \bH \|^2$ evaluates 
how well $\bTes$ is represented by $L^\rho$ columns of its coefficients in the transform $\bH$.

The upper bound  for $\|\bZ \bV^{(\rho)} -  \bPhis^{(\rho)}\|^2$   can be found by repeating the calculations in Lemma 2.1 of Gao \etal (2015) 
with the only difference that $f$ is replaced by $v_l$ and there is an additional sum over $l = 1, \cdots L^\rho$.
Then, we obtain 
\be \label{bias1}
 \|\bZ \bV^{(\rho)} -  \bPhis^{(\rho)}\|^2  \leq K_1  2^{2 \nu_1} n^2 L^\rho\,  h^{-2 \nu_1}.
\ee
On the other hand, if $\rho <1$, then by Assumption {\bf A},
\be \label{bias2}
\| \bPhis - (\bPhis)^{(\rho)}\|^2 \leq \sum_{i_1=1}^n\, \sum_{i_2 =1}^n\ \sum_{l = L^\rho +1}^L \bv_l^2 (\zeta_{i_1}, \zeta_{i_2}) 
\leq K_2 n^2 L^{-2 \nu_2 \rho}
\ee
and $\| \bPhis - (\bPhis)^{(\rho)}\|^2 =0$ if $\rho=1$. 
Now, note that  for  given $m$ and $\rho$,  one has $|J| \leq m^2 L^\rho$, so that 
\be \label{gra_pen} 
\Pen(|J|,m) \leq C \lkv n \log m +   m^2 L^\rho \log(25\, L^{1-\rho})\rkv.
\ee  
Therefore,   \fr{sr}--\fr{gra_pen}  yield  \fr{graph_upper}.
\\
 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\medskip

\noindent
{\bf Proof of Corollary \ref{cor:upper_graphon}.  }
Note that if    $\nu_1 =\infty$, one can set $h=2$, so that the first term in \fr{graph_upper} is equal to zero, 
$h+r \leq 3 r$ and 
\bes  
\frac{\EE \|\hbLam - \bLams\|^2}{n^2\,L} \leq C \lfi \frac{I(\rho <1)}{L^{2 \rho \nu_2+1}} + 
\lkr\frac{r}{n}\rkr^2 \frac{1 + (1 - \rho)\log L}{L^{1-\rho}}  + \frac{\log r}{n L}\rfi.
\ees
Minimizing this expression with respect to $\rho \in [0,1]$ obtain the result in  \fr{graph_upper_cases} for $r = r_{n,L}$.
%
If $r=r_0$, then 
\be \label{risk2}
\frac{\EE \|\hbLam - \bLams\|^2}{n^2\,L} \leq C \lfi  
\frac{L^{\rho-1}}{h^{2 \nu_1}} + \frac{I(\rho <1)}{L^{2 \rho \nu_2+1}} + \frac{h^2\log L}{n^2 L^{1-\rho}}  
+ \frac{\log h}{n  L}  \rfi.
\ee 
Minimizing \fr{risk2} with respect to $h$ and $\rho$, obtain that the   values $h^*$ and $L^* = L^{\rho^*}$  delivering the minimum in 
\fr{risk2} are such that    $h^* \asymp  (n^2/\log L)^{1/(2(\nu_1+1)}$.
Hence, for some absolute constants $C$, one has  $\log (h^*) \leq C \log n$  and 
\bes
L^* =   L^{\rho^*} = \min \lfi L, C\, \lkr  n^2/\log L \rkr^{\frac{\nu_1}{(\nu_1 +1)(2 \nu_2+1)}}\rfi. 
\ees
Therefore,  \fr{graph_upper_cases} holds for $r = r_0$.
\\

 

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% \subsection{Proof of Theorem \ref{th:lower_graphon}}
%\label{sec:lower}


  

 \noindent
 {\bf Proof of Theorem \ref{th:lower_graphon}. } 
We consider the cases when $r = r_{n,L}$ and $r=r_0$,
corresponding to piecewise constant and piecewise smooth graphon, separately.
\\
 

\underline{\bf Piecewise constant graphon. }
Assume, without loss of generality, that $j = n/r$ is an integer.  
Consider a set up where the nodes are grouped into $r$ classes and 
values of $\zeta_j$'s are fixed:   
\bes
\zeta_{k j + i} = \beta_k + (i-1/2)  (\beta_{k+1} - \beta_k)/j,
\quad k = 0, \cdots, r-1, \ i = 1, \cdots, j.
\ees
Then, there are $j$ nodes in each class.   
Let $\bG_{k,k,l} =0$ for any $k=1, \cdots, r$ and $l=1, \cdots, L$.



Consider an even number $L_0$ such that $1 \leq L_0 \leq L/2$ and a set of vectors $\bom \in \{ 0,1\}^{L_0}$ 
with exactly $L_1 = L_0/2$ nonzero entries.
%
By Lemma 4.10 of Massart (2007), there exists a subset $\calT$ of those vectors such that 
for any $\bom, \bom' \in \calT$ one has 
\be \label{bombom}
\|\bom - \bom'\|_H \geq L_0/4, \quad
\log |\calT| \geq 0.233 (L_0/2) \log 2 \geq 0.08 L_0.
\ee 
Denote $\calK = \{(k_1, k_2):\ 1 \leq k_1 < k_2 \leq r\}$ and 
let  $\calT_{k_1, k_2}$ be the copies of $\calT$ for $(k_1, k_2) \in \calK$. 
Denote $\tilde{\calT} = \bigotimes_{(k_1,k_2) \in \calK}\, \calT_{k_1, k_2}$ and
observe that 
\bes
\log|\tilde{\calT}| = r(r-1)/2 \log |\calT| \geq 0.02 r^2\, L_0.
\ees
Then, $\tilde{\bom} \in \tilde{\calT}$ are   binary tensors with elements $\bom_{l}^{(k_1, k_2)}$,$l=1, \cdots, L_0$
and  $(k_1,k_2) \in \calK$.
Consider a set of functions $f^{(\tilde{\bom})}$ indexed by  $\tilde{\bom}$
such that, for $\beta_{k_1-1}  < x \leq \beta_{k_1}$ and $\beta_{k_2-1} < y \leq \beta_{k_2}$,
their coefficients in the transform $\bH$ are given by 
\bes
\bv_1^{(\tilde{\bom})} (x,y) = \sqrt{L}/2; \quad \bv_l^{(\tilde{\bom})}  (x,y) =  
\al  \bom_{l-L_0}^{(k_1, k_2)},\ l=L_0+1, \cdots, 2L_0  , \  (k_1,k_2) \in \calK.
% \quad \mbox{if}
% \beta_{k_1-1}  < x \leq \beta_{k_1}, \ \beta_{k_2-1} < y \leq \beta_{k_2}.
\ees  
% where $\tilde{\bom}$ is a binary matrix with elements $\bom_{l}^{(k_1, k_2)}$,$l=1, \cdots, L_0$
% and  $(k_1,k_2) \in \calK$.
%
Then, Assumption \fr{A1} holds. In order condition \fr{A2} is satisfied, we set
\be \label{rhoL0}
\al^2 \leq C_1 L_0^{-(2 \nu_2 +1)}  \quad \mbox{with} \quad C_1 \leq  \min(K_2 2^{1 - 2\nu_2},1/8).
\ee 
Denote by $\bLam$ and $\bLam'$ the probability tensors corresponding, respectively,  to $\tilde{\bom}$ and 
$\tilde{\bom'}$ in $\tilde{\calT}$. Then, due to \fr{bombom} and the symmetry, 
\beqns
\|\bLam - \bLam'\|^2 &\geq &  2 \al^2 \sum_{k_1 =1}^r \sum_{k_2 = k_1 +1}^r 
\|\bom^{(k_1, k_2)} - \bom'^{(k_1, k_2)}\|_H \lkr \frac{n}{r}\rkr^2  \geq \frac{\al^2 n^2 L_0}{8};\\
\|\bLam - \bLam'\|^2 &\leq &    \al^2 r(r-1) (n/r)^2 L_0 \leq \al^2 n^2 L_0.
\eeqns
Note that  one has $1/4 \leq f(x,y,t) \leq 3/4$ provided
$\|\bH^T \bom ^{(k_1, k_2)}\|_\infty \leq 1/4$ for for $(k_1, k_2) \in \calK$.
By  Assumption \fr{H_assump}, the latter is guaranteed by 
$\al^2 L_0^2/L \leq 1/4$, so that, due to $L  \geq 2 L_0$ and $\nu_2 \geq 1/2$,
it is ensured by \fr{rhoL0}. Then, by Lemma~\ref{lem:Gao2015}, one has 
\bes
K (\PP_{\bLam}, \PP_{\bLam'}) \leq 8\, \| \bLam - \bLam'\|^2  \leq
8  \al^2 n^2 L_0 \leq \log |\tilde{\calT}|/8   
\ees  
provided 
\be \label{rho_con1}
\al^2 \leq C_2 (r/n)^2
\ee
 where $C_2$ is an absolute constant.
Therefore, application of Theorem 2.5 of Tsybakov (2009) yields \fr{graph_lower_ineq}
with 
$\Del(n,L) = C\,\al^2 L_0/L$ 
where $C$ is an absolute constant.



Now, we denote $C_3^2 = (C_2/C_1) 2^{-(2 \nu_2 +1)}$ and consider two cases.   
If $n \leq C_3 r L^{\nu_2 + 1/2}$, choose $L_0 = [(C_1/C_2) (n/r)^2]^{1/(2 \nu_2 +1)}$ 
which leads to $\al^2 = C_1 L_0^{-(2 \nu_2 +1)} = C_2 (r/n)^2$.  
It is easy to check that $L_0 \geq 2$ and that $L_0 \leq L/2$, so that  
\bes 
\Del(n,L) =   \frac{C}{L} \lkv \lkr \frac{r}{n}\rkr^2   \rkv^{\frac{2 \nu_2}{2 \nu_2+1}}.
\ees
If  $n > C_3 r L^{\nu_2 + 1/2}$, choose $\al^2 = C_2 (r/n)^2$ and set $L_0 = L/2$. Then, 
\fr{rhoL0} holds and $\Del(n,L) = C (r/n)^2$ which completes the proof of the lower bound 
when $r = r_{n,L}$.
\\
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5


\underline{\bf Piecewise smooth graphon. }
Since $r=r_0$ is a fixed quantity, without loss of generality, we set $r=1$.
Let  $\zeta_j = j/n, j=1, \cdots, n$, be fixed. Let $h$   be a positive integer, $1 \leq h \leq n$,
and denote $\del = 1/h$. Consider a kernel function $F(x)$ such that 
$F(x)$ is $n_1 > \nu_1$ times continuously differentiable  and for any $x,x' \in \RR$ and some $C_F >0$
\be \label{kern_properties}
\supp (F) = (-1/2; 1/2), \quad |F(x) - F(x')| \leq C_F |x  - x'|^{\nu_1}.
\ee
It follows from \fr{kern_properties} that $|F(x)| \leq C_F$ for any $x$.
Denote % $u_k = (k-1)\del + \del/2$, $k=1, \cdots, h$ and 
\be \label{Psi}
\Psi_{k_1, k_2} (x,y) = h^{-\nu_1} F(h(x - u_{k_1})) F(h(y - u_{k_2}))
%\quad \mbox{where} \quad u_k = (k-1/2)\del, \ k=1, \cdots, h.
\ee
where $u_k = (k-1/2)\del, \ k=1, \cdots, h$.
It is easy to see that $\Psi_{k_1, k_2} (x,y)= \Psi_{k_2, k_1} (y,x)$ 
and, for different pairs  $(k_1, k_2)$,  functions  $\Psi_{k_1, k_2} (x,y)$
have disjoint supports. Similar to the case of the piecewise constant graphon, 
consider an even  $L_0 \leq L/2$ and a set of vectors $\bom \in \{ 0,1\}^{L_0}$ with exactly $L_0/2$ nonzero entries.
%
By Lemma 4.10 of Massart (2007), there exists a subset $\calT$ of those vectors such that \fr{bombom} holds
for any $\bom, \bom' \in \calT$.
Let again $\calT_{k_1, k_2}$ be the copies of $\calT$ for $(k_1, k_2) \in \calK$ 
and denote $\tilde{\calT} = \prod_{(k_1,k_2) \in \calK} \calT_{k_1, k_2}$
where $\calK = \{(k_1, k_2):\ 1 \leq k_1 < k_2 \leq h\}$.
Then, 
\be \label{card11}
\log|\tilde{\calT}|= h(h+1)/2\, \log|{\calT}| \geq 0.04\, L_0 h^2. 
\ee
For any $\tilde{\bom} \in \tilde{\calT}$ and $l=L_0+1, \cdots, 2L_0$, define 
\begin{align} 
& \bv_1^{(\tilde{\bom})} (x,y) = \sqrt{L}/2; \label{bv_val} \\
& \bv_l^{(\tilde{\bom})} (x,y) =  
\al   \sum_{k_1 =1}^h \sum_{k_2 = k_1 + 1}^h \bom_{l-L_0}^{(k_1, k_2)}\, [\Psi_{k_1, k_2} (x,y) + \Psi_{k_2, k_1} (x,y)].
\nonumber 
%\quad l=L_0+1, \cdots, 2L_0.
 \end{align}   
It is easy to see that $\bv^{(\tilde{\bom})} (x,y) = \bv^{(\tilde{\bom})} (y,x)$ for any $x,y \in [0,1]$. 
Now we need to check that conditions \fr{A1} and \fr{A2} hold. 


Note that for any $x,y,x',y'$, due to \fr{kern_properties}, obtain
\begin{align}
& |\Psi_{k_1, k_2} (x,y)   - \Psi_{k_1, k_2} (x',y')|   \leq 
h^{-\nu_1} \lkv |F(h(x-u_{k_1})- F(h(x'-u_{k_1})| |F(h(y-u_{k_2})| \right. \nonumber \\
& \left. +  |F(h(y-u_{k_2})- F(h(y'-u_{k_2})| |F(h(x'-u_{k_1})| \rkv  
  \leq C_{\psi}  \lkv |x-x'| + |y-y'| \rkv^{\nu_1}, \label{ineqPsi}
\end{align}
where constant $C_{\psi}$ depends  only on $C_F$ and $\nu_1$.
Since functions $\Psi_{k_1, k_2} (x,y)$ have disjoint supports for different pairs of indices  $(k_1, k_2)$, 
the sums below have at most four nonzero terms. Then, \fr{ineqPsi} implies that 
\begin{align*}
& \left| \bv_l^{(\tilde{\bom})} (x,y) - \bv_l^{(\tilde{\bom})} (x',y')\right| 
\leq \al \sum_{k_1, k_2=1}^h   |\Psi_{k_1, k_2} (x,y)   - \Psi_{k_1, k_2} (x',y')|\\
& \leq 4 \al\,  C_{\psi}\  \lkv |x-x'| + |y-y'| \rkv^{\nu_1},
\end{align*}
so that \fr{A1} holds if $\al \leq K_1/(4   C_{\psi})$.  
%
Also, it is easy to check that, by \fr{kern_properties}, one has
$[\bv_l^{(\tilde{\bom})} (x,y)]^2 \leq C_v^2  \al^2 h^{-2\nu_1}$ where $C_v$ depends  only on $C_F$ and $\nu_1$.
Therefore, 
\bes
\sum_{l = L_0+1}^{2L_0} (l-1)^{2 \nu_2} [\bv_l^{(\tilde{\bom})} (x,y)]^2  \leq C_v^2 \al^2 h^{-2\nu_1} L_0^{2 \nu_2+1}.
\ees  
 Hence, both assumptions, \fr{A1} and \fr{A2} are valid provided
\be \label{rhoineq}
\al \leq \min \lkr K_1/(4   C_{\psi}),\ \sqrt{K_2}/C_v\, h^{\nu_1} L_0^{-(\nu_2+1/2)}\rkr.
\ee
Denote by $\bLam$ and $\bLam'$ the probability tensors corresponding to $\tilde{\bom}$ and 
$\tilde{\bom'}$ in $\tilde{\calT}$, respectively. 
Let $\tilde{\bv} (x,y)$ be a vector with  $\tilde{\bv}_1 (x,y) = 0$ and $\tilde{\bv}_l (x,y) = \bv_l (x,y)$
for $l\geq 2$. 
By \fr{H_assump} and \fr{bv_val}, since $\Psi_{k_1, k_2} (x,y)$ have disjoint supports,
we derive that for any $\tilde{\bom} \in \tilde{\calT}$ one has
\bes
\left| \Lam_{i,j,l}  - 1/2\right| \leq    \| \bH \tilde{\bv}  (x,y) \|_\infty
\leq  \|\tilde{\bv}  (x,y) \|_1/\sqrt{L} \leq C_v \al L_0 h^{-\nu_1}/\sqrt{L}.
\ees
Hence, $\bLam_{i,j,l}, \bLam'_{i,j,l} \in [1/4;3/4]$ provided
\be \label{rho_as1}
\al \leq \sqrt{L}\, h^{\nu_1}/(4 C_v  L_0).
\ee  
Then, by   Lemma~\ref{lem:Gao2015}, since each $\bom \in   \calT$ has exactly $L_0/2$ nonzero entries  
\begin{align*}
K (\PP_{\bLam}, \PP_{\bLam'}) & \leq    8 \|\bLam - \bLam'\|^2  
\leq 8 \al^2  L_0/2\ \sum_{i,j}^n \sum_{k_1, k_2}^h 4\, \lkv \Psi_{k_1, k_2} \lkr \frac{i}{n}, \frac{j}{n} \rkr \rkv^2\\
& =   16 \al^2  h^{-2\nu_1} L_0 \ \sum_{i,j}^n \sum_{k_1, k_2}^h F^2 (h(i/n-u_{k_1})) F^2 (h(j/n-u_{k_2})) \\
& =   16 \al^2  h^{-2\nu_1} L_0 \lkv  \sum_{i=1}^n \sum_{k=1}^h F^2(h(i/n-u_k))\rkv^2.
\end{align*}  
Here, 
\begin{align} \label{F_integral}
&  \sum_{i=1}^n \sum_{k=1}^h F^2(h(i/n-u_k))   = 
\sum_{k=1}^h \quad  \sum_{u_k-\del/2 <i/n \leq u_k+\del/2} F^2(h(i/n-u_k))   \\
& \approx   n \sum_{k=1}^h \int_{u_k-\del/2}^{u_k+\del/2} F^2(h(i/n-u_k)) dx 
   =   n \int_{-1/2}^{1/2}  F^2(z) dz,  \nonumber
\end{align} 
so that 
\be \label{KL11}
K (\PP_{\bLam}, \PP_{\bLam'}) \leq 16\, \|F\|_2^4\, \al^2  h^{-2\nu_1} n^2 L_0
\ee 
where $\|F\|_2$ is the $L^2$-norm of $F$.
On the other hand,  due to the first inequality in \fr{bombom} and \fr{F_integral}, obtain  
\begin{align*}
&\frac{\|\bLam - \bLam'\|^2}{n^2\, L} \geq    \frac{2 \al^2}{n^2\, L} \, \sum_{l=L_0+1}^{2L_0} \, \sum_{k_1 =1}^r \sum_{k_2 = k_1 +1}^r  
\sum_{i=1}^n \sum_{j=1}^n [\bom_l^{(k_1, k_2)} - {\bom'_l}^{(k_1, k_2)}]^2 [\Psi_{k_1, k_2} (i/n, j/n)]^2\\
&\geq  \frac{\al^2 h^{-2\nu_1} L_0}{4\, n^2 \, L} \lkv \sum_{i=1}^n \sum_{k=1}^h F^2(h(i/n-u_k)) \rkv^2 
\geq  \frac{\al^2 h^{-2\nu_1} L_0}{8\, L} \|F\|_2^4.
\end{align*} 
 Application of Theorem 2.5 of Tsybakov (2009) yields that
\fr{graph_lower_ineq} holds with 
$\Del(n,L) = C\, \al^2 h^{-2\nu_1} L_0/L$ provided $K (\PP_{\bLam}, \PP_{\bLam'}) \leq 1/8 \log|\tilde{\calT}|$,
which, due to \fr{card11} and \fr{KL11}, is guaranteed by 
\bes
4 \|F\|_2^4 \al^2  h^{-2\nu_1} n^2 L_0 \leq (1/8)\,  (0.04 L_0 h^2)/2
\ees
and leads to  the following restriction on $\al$:
\be \label{rho_as2}
\al \leq  h^{\nu_1 +1} n^{-1} /(40 \sqrt{2} \|F\|_2^2).
\ee
Set 
\be \label{hL0}
h = n^{\frac{1}{\nu_1+1}},\   L_0 = \min\lkr n^{\frac{2 \nu_1}{(\nu_1+1)(2 \nu_2 +1)}},\frac{L}{2} \rkr,\   
n_L = \lkr \frac{L}{2} \rkr^\frac{(\nu_1+1)(2 \nu_2 +1)}{2 \nu_1} 
\ee 
and consider two cases. 


If $n \leq n_L$, then $L_0$ is given by the first expression 
in \fr{hL0} and    inequalities \fr{rhoineq}, \fr{rho_as1} and \fr{rho_as2}  hold if $\al^2$ is a small enough 
absolute constant that depends on $\nu_1, \nu_2, K_1$ and $K_2$ only. In this case, 
$\Del(n,L) = C\, L^{-1}    n ^{-\frac{4 \nu_1 \nu_2}{(\nu_1 +1) (2\nu_2+1)}}$
and \fr{graph_lower_cases} is valid. 

If $n > n_L$, then $L_0=L/2$ and again all inequalities \fr{rhoineq}, \fr{rho_as1} and \fr{rho_as2}  hold if $\al^2$ is a small enough 
absolute constant that depends on $\nu_1, \nu_2, K_1$ and $K_2$ only.
In this case, $\Del(n,L) = C\,  n^{-\frac{2\nu_1}{\nu_1 +1}}$ which completes the proof.
 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
  

\subsection{Proofs of supplementary statements}
\label{sec:supplement}

In this section, we formulate and prove supplementary lemmas used in the proofs of other statements.
\\


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5


% lemma 2
\begin{lemma} \label{lem:bern_err}
Let $a_i$ be independent Bernoulli$(\te_i)$ variables and 
consider vectors $\ba$ and $\bte$ with components $a_i$ and $\te_i$,
respectively. Then, for any vector $\bz$ and any positive $t$ and   $\al$ one has
\be \label{expineq_bernoulli}
\PP \lkr 2 |\bz^T(\ba - \bte)| >  \af \| \bz \|^2  +  2t/\al \rkr \leq 2 e^{-t}, \quad
\EE \lkv \exp (\bz^T(\ba - \bte) \rkv \leq \exp(\|\bz\|^2/8).
\ee
\end{lemma}
 

\noindent
{\bf Proof. } Validity of the  Lemma follows from Hoeffding inequality (see, e.g., Massart (2007)).
\\

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% lemma 3
\begin{lemma} \label{lem:subgaus_quadr_err}
Let $\bxi$ be a vector with independent components, $\EE \bxi = 0$ and such that for any vector 
$\bz$ and some $\sig>0$ one has
\be \label{subgaus_cond}
\EE \lkv \exp (\bz^T \bxi) \rkv \leq \exp(\|\bz\|^2 \sig^2/2).
\ee
Then, for any matrix  $\bA$ and any positive $t$   one has
\be \label{subgaus_expineq_quadr}
\PP \lfi \|\bA\bxi \|^2  > \sig^2 \lkr 2 \| \bA \|^2 +   3 \,\| \bA \|_{op}^2\, t \rkr \rfi \leq  e^{-t}.
\ee
\end{lemma}

\noindent
{\bf Proof. } Denote   $\bSig = \bA^T \bA$ and use Theorem 2.1 of Hsu \etal (2012).
Obtain, for any $t>0$,  
\bes
\PP \lkv \|\bA \bxi \|^2  > \sig^2 \lkr \Tr(\bSig) + 2   \sqrt{t\, \Tr(\bSig^2)} 
+2 t\, \|\bSig\|_{op}  \rkr \rkv \leq e^{-t}.  
\ees
Note that $\Tr(\bSig^2) \leq \|\bSig\|_{op} \Tr(\bSig)$ and $2 \sqrt{xy} \leq x+y$ for any positive $x$ and $y$.
In order to complete the proof, recall that $\|\bSig\|_{op} = \| \bA \|_{op}^2$ and $\Tr(\bSig) = \| \bA \|^2$.
\\


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{corollary} \label{corr:quadr_err}
Let $a_i$ be independent Bernoulli$(\te_i)$ variables and 
consider vectors $\ba$ and $\bte$ with components $a_i$ and $\te_i$,
respectively. Then, for any matrix  $\bA$ and any positive $t$   one has
\be \label{expineq_quadr}
\PP \lkr \|\bA (\ba - \bte)\|^2  > \frac{  \| \bA \|^2}{2} +  \frac{3t\,\| \bA \|_{op}^2}{4}\rkr \leq  e^{-t}.
\ee
\end{corollary}


\noindent
{\bf Proof. } Denote $\bxi = \ba-\bte$ and note that, due to \fr{expineq_bernoulli}, condition \fr{subgaus_cond}
holds with $\sig = 1/2$.
\\

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% lemma 4
\begin{lemma} \label{lem:packing} {\bf (The packing lemma). }
Let $\calZ (m,n) \subseteq \calM (m,n)$ be a collection of clustering matrices.
Then, there exists a subset $S_{n,m} (r) \subset \calZ (m,n)$ such  that 
for $\bC_1, \bC_2 \in \calZ (m,n)$ one has 
$\| \bC_1 - \bC_2 \|_H =  \| \bC_1 - \bC_2 \|^2 \geq r$
and 
$\log |S_{n,m} (r)| \geq  \log|\calZ (m,n)| - r \log (n e m/r)$.
\end{lemma}

\noindent
{\bf Proof. } For any clustering matrix $\bC$ define the $r$-neighborhood of $\bC$ as 
\bes
\calB (\bC, r) = \lfi \tilbC \in \calZ (m,n):\ \|\tilbC - \bC\|_H \leq r \rfi.
\ees
Let $\tilS_{n,m}(r)$ be the covering set of $\calZ (m,n)$ and $|\tilS_{n,m}(r)|$
be the covering number, the smallest number of closed balls of radius $r$ whose union
covers $\calZ (m,n)$.  Let $|S_{n,m}(r)|$ be the packing number of $\calZ (m,n)$,
the largest number of points with the distance at least $r$ between them. 
It is known (see Pollard (1990), page 10) that
\be \label{pollard_ineq}
|\tilS_{n,m}(r)| \leq |S_{n,m}(r)| \leq |\tilS_{n,m}(r/2)|
\ee 
Note that $|\calZ (m,n)| \leq \sum_{\bC \in \tilS_{n,m}(r)} |\calB (\bC, r)| \leq 
|\tilS_{n,m}(r)| \max_{\bC \in \tilS_{n,m}(r)} |\calB (\bC, r)|$, so that
%
\be \label{cardF}
|\tilS_{n,m}(r)| \geq  |\calZ (m,n)| \Bigg/  \max_{\bC \in \tilS_{n,m}(r)} |\calB (\bC, r)| 
\ee 
and, also, 
\be \label{cardB}
|\calB (\bC, r)| \leq {n \choose r} m^r \leq \lkr \frac{ne}{r}\rkr^r m^r = \lkr \frac{n e m}{r}\rkr^r.
\ee
Now, combining \fr{pollard_ineq} -- \fr{cardB}, obtain
$\log |S_{n,m}(r)| \geq \log |\tilS_{n,m}(r)|  \geq \log |\calZ (m,n)| - r \log(n e m/r)$
which completes the proof.
\\



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% lemma 5
\begin{lemma} \label{lem:cardinality}
Let $\ga m$ and $n/m$ be positive integers. Then, for $n_0 \geq 1$ and $\ga m \geq 2$, one has
\begin{align}
& \log \lfi (\ga n)! \rfi - \ga m \, \log \lfi \lkr n/m \rkr !\rfi \geq \frac{\ga n}{4} \log(\ga m); \label{AA1}\\
& \log \lfi {m \ga \choose n_0} \lkr \frac{n}{m} \rkr^{n_0} (n_0-1)!  \rfi \geq n_0 \log\lkr \frac{\ga n}{n_0} \rkr 
+ \frac{n_0}{2} \log \lkr \frac{n_0}{2}\rkr; \label{AA2}\\
& 6 \ga n \log(\ga m)  -  \ga n  \log(32\, m   \ga \, e) \geq 0. \label{AA3}
\end{align}
\end{lemma}


\noindent
{\bf Proof. } Note that due to \fr{inequalities}, one has 
\bes
A_1  = \log \lfi (\ga n)! \rfi - \ga m \, \log \lfi \lkr n/m \rkr !\rfi  
\approx \ga n \log (\ga m) - \frac{\ga m}{2} \log \lkr\frac{2 \pi n}{m}\rkr + \frac{1}{2} \log(2\pi \ga n).
\ees 
Consider a function
\bes
F(x) = \frac{3 \ga n}{4} \log x  - \frac{x}{2} \log \lkr \frac{2 \pi \ga n}{x} \rkr + \frac{1}{2} \log(2 \pi \ga n).
\ees 
It is easy to check that $F(1)=0$ and that 
$F'(x) =  0.75\, \ga n/x  - 0.5 \log(2 \pi \ga n/(x e))$. Replacing $2 \pi \ga n/(x e)$ in $F'(x)$ by $z$ and noting that the inequality
$3e/(4 \pi) z > \log z$ is true for any $z>0$, we confirm that $F'(x) >0$. so that $F(x) >0$ for any $x \geq 1$. 
Finally, in order to prove \fr{AA1}, observe that $A_1 = F(\ga m) +  \ga n \log(\ga m)/4$.


For the sake of proving \fr{AA2},  note that for every $n_0 \geq 1$ one has 
$\log[(n_0-1)!] \geq 0.5\, n_0 \log(n_0/2)$ and apply the first inequality in \fr{inequalities}.

The validity of  inequality \fr{AA3} follows from $\ga m \geq 2$ and the fact that $\log(64 e) < 6$.  
\\ 


 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% lemma 6
\begin{lemma} \label{lem:subgaussian}
Let $a_i$ be independent  Bernoulli$(\te_i)$ variables with $0\leq \te_i \leq \rho < 1/2$, $i=1, \cdots, n$. 
Denote $\xi_i = a_i - \te_i$  and 
\be \label{sum_subgaus}
\zeta = \frac{1}{\sqrt{n}} \ \sum_{i=1}^n \xi_i.
\ee
Then, $\zeta$ is a sub-Gaussian random variable with sub-Gaussian norm 
\be \label{subgaus}
\|\zeta\|_{\psi_2} = \sup_{p \geq 1} \lkr p^{-1/2}\, \EE |\zeta|^p\rkr^{1/p} \leq \frac{3 e^2}{2} \, \max \lkr \rho, \frac{1}{n} \rkr. %, \quad p \geq 1.
\ee
\end{lemma}
 


\noindent
{\bf Proof. } First, observe that we need to check inequality of the type \fr{subgaus} only for an even integer $p=2m$.
Recall that $\|\zeta\|_{\psi_2} \leq K_0$ provided 
$\EE |\zeta|^p \leq (K_0 \sqrt{p})^p = (K_0^2 p)^{p/2}$ for every $p \geq 1$. Suppose that  
 $\EE |\zeta|^{2m}  \leq (K_1 \sqrt{2m})^{2m} = (2 K_1^2 m)^m$ for every integer $m \geq 1$ and some  some $K_1 >0$.    
%
For any $p \geq 1$ choose $m$ such that $2m-2 < p \leq 2m$ which implies  $2m < p+2$. Then,
$$
\EE |\zeta|^p \leq \lkr \EE  \zeta^{2m} \rkr^{\frac{p}{2m}} \leq \lkr (2 K_1^2 m)^m \rkr^{\frac{p}{2m}} \leq \lkr   K_1^2 (p+2) \rkr^{\frac{p}{2}}
$$
Observing that $p+2 \leq 3p$ for $p\geq 1$, obtain that  $\EE |\zeta|^p \leq  [(\sqrt{3} K_1)^2 p]^{p/2}$. 
Hence, \fr{subgaus} is valid provided that for any $m \geq 1$
\be \label{2m_ineq}
\EE (\zeta)^{2m} = \EE \lkr \frac{1}{\sqrt{n}} \ \sum_{i=1}^n \xi_i \rkr^{2m} 
\leq  (e^2 m \rho_n)^m, \quad \rho_n= \max(\rho, 1/n). % ,\quad m \geq 1.
\ee
%
Note that 
\bes  
\EE (\zeta)^{2m} =  \sum \frac{\EE(\xi_{i_1}^{m_1} \ldots \xi_{i_l}^{m_l})}{n^m}
\ees
where the sum is taken over all positive integers $l, m_1, \ldots, m_l, i_1, \ldots, i_l$ such that $2m = m_1 + m_2 + m_l$
and $i_1, \ldots, i_l$ are distinct. Note that $\EE \xi_i =0$ for every $i$, hence, in the sum the terms with $m_l=1$ are 
equal to zero. Therefore, 
% 
\be \label{2m_ineq1}
\EE (\zeta)^{2m} \leq  \sum_{l}  S(m,l) P(n,l) \frac{\EE (\xi_{i_1}^{m_1} \ldots \xi_{i_l}^{m_l})}{n^m}
\ee
where $S(m,l)$ is the number of partitions of $2m$ unlabeled objects into $l$ distinct subparts of size at least two,
and $P(m,l)$ is the number of ways of choosing $l$ variables out of $n$ (order matters since powers can be different):
$$
S(m,l) = {2m-l-1 \choose l-1}, \quad P(n,l) = \frac{n!}{(n-l)!} \leq n^l.
$$
Here, $2m - l-1 \geq l-1$, so that $l \leq m$. Observe that due to
$$
\EE \xi_i^k =  \te_i(1-\te_i) [(-\te_i)^{k-1} + (1-\te_i)^{k-1}] \leq \rho,
$$ 
\fr{2m_ineq1} yields 
\bes 
\EE (\zeta)^{2m} \leq  \sum_{l=1}^{\min(m,n)}  {2m-l-1 \choose l-1} \frac{\rho^l}{n^{m-l}}.
\ees
By considering the cases $\rho \geq 1/n$ and $\rho < 1/n$ separately, it is easy to show that
$$
\frac{\rho^l}{n^{m-l}} \leq [\max(\rho, n^{-1})]^m  = \rho_{n}^m,
$$
so that 
\bes 
\EE (\zeta)^{2m} \leq \rho_{n}^m\ \sum_{l=0}^{\min(m,n)}  {2m-l  \choose l}  \leq 
\rho_{n}^m\ \sum_{l=0}^{\infty}  \frac{(2m)^l}{l!} \leq \rho_{n}^m\, e^{2m} = (e^2 \rho_{n})^m
\ees
which implies \fr{2m_ineq} and, hence, \fr{subgaus}.
\\

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5

\begin{corollary} \label{cor:subgaus}
Let $\ba \in [0,1]^n$ be a random vector with 
 independent Bernoulli$(\te_i)$ components. Let $\bxi = \ba - \bte$ and $\bZ \in \calM (M,N)$ be a clustering matrix
with $\bS^2 = \bZ^T \bZ = \diag(N_1, \cdots, N_M)$. Define $\boeta = \bS^{-1} \bZ^T \bxi$. 
Then, vector $\boeta$ has independent sub-Gaussian 
components with  
\bes
\| \boeta_k \|_{\psi_2}^2 \leq   \frac{3e^2}{2} \, \max( \|\te\|_{\infty}, N_k^{-1}).
\ees
\end{corollary}



\noindent
{\bf Proof. } Validity of the Lemma follows from the fact that each $\boeta_k$ is of the form \fr{sum_subgaus}
and is evaluated using a distinct set of components of vector $\bxi$.
\\

 
\vspace{4mm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{lemma} \label{lem:Gao2015} {\bf (Proposition 4.2 of Gao, Lu and Zhou (2015)) }
Let $\bte = \{ \te_{i,j}\} \in [0,1]^{n \times n}$. Let $\PP_{\te_{i,j}}$ denote the probability of
Bernoulli $(\te_{i,j})$ and the probability $\PP_{\bte}$ stands for the product measure 
$\PP_{\bte} = \otimes_{i,j} \PP_{\te_{i,j}}$.  Then, for any $\bte, \bte' \in [1/4, 3/4]^{n \times n}$ 
one has
$$
K(\PP_{\bte},\PP_{\bte'}) \leq 8 \, \sum_{i,j} (\te_{i,j} - \te'_{i,j})^2.
$$
\end{lemma}
 




 
 




 
